using Newtonsoft.Json;
using Topo.Model.ReportGeneration;
using TopoReportFunction;

namespace TopoReportFunctionTest
{
    [TestClass]
    public class Progress
    {
        private ReportGenerationRequest _reportGenerationRequest;
        private Function _function;

        [TestInitialize]
        public void SetUp()
        {
            _function = new Function();
            _reportGenerationRequest = new ReportGenerationRequest()
            {
                ReportType = ReportType.PersonalProgress,
                GroupName = "Epping Scout Group",
                Section = "scout",
                UnitName = "Scout Unit",
                OutputType = OutputType.PDF,
                ReportData = "{\"Member\":{\"id\":\"4d41f446-9963-3ffd-a677-1fd4eef84cb5\",\"member_number\":\"1102294\",\"first_name\":\"Jane\",\"last_name\":\"Scout\",\"status\":\"active\",\"age\":\"12y 11m\",\"unit_council\":true,\"patrol_name\":\"Platypus\",\"patrol_duty\":\"PL\",\"patrol_order\":1,\"isAdultLeader\":0,\"selected\":false},\"GroupName\":\"(Epping Scout Group)\",\"IntroToScoutingDate\":\"24/06/19\",\"IntroToSectionDate\":\"23/06/2021\",\"Milestones\":[{\"Milestone\":1,\"Status\":\"Awarded\",\"Awarded\":\"2022-07-24T18:00:06.816562+10:00\",\"ParticipateLogs\":[{\"ChallengeArea\":\"creative\",\"EventName\":\"Camp fire cooking\",\"EventDate\":\"2021-02-18T06:00:00+11:00\"},{\"ChallengeArea\":\"creative\",\"EventName\":\"Eggstravaganza\",\"EventDate\":\"2021-04-22T05:00:00+10:00\"},{\"ChallengeArea\":\"creative\",\"EventName\":\"Tie-Dye Night\",\"EventDate\":\"2021-05-27T05:00:00+10:00\"},{\"ChallengeArea\":\"creative\",\"EventName\":\"Origami Night\",\"EventDate\":\"2021-08-18T19:00:00+10:00\"},{\"ChallengeArea\":\"creative\",\"EventName\":\"Slackline and bridge building\",\"EventDate\":\"2022-03-02T19:00:00+11:00\"},{\"ChallengeArea\":\"creative\",\"EventName\":\"Knot Challenge\",\"EventDate\":\"2022-03-30T19:00:00+11:00\"},{\"ChallengeArea\":\"outdoors\",\"EventName\":\"Summer Sailing\",\"EventDate\":\"2021-02-08T01:00:00+11:00\"},{\"ChallengeArea\":\"outdoors\",\"EventName\":\"Summer Sailing\",\"EventDate\":\"2021-02-22T01:00:00+11:00\"},{\"ChallengeArea\":\"outdoors\",\"EventName\":\"Navigation Night\",\"EventDate\":\"2021-02-25T06:00:00+11:00\"},{\"ChallengeArea\":\"outdoors\",\"EventName\":\"Summer Sailing\",\"EventDate\":\"2021-03-01T01:00:00+11:00\"},{\"ChallengeArea\":\"outdoors\",\"EventName\":\"Summer Sailing\",\"EventDate\":\"2021-03-08T01:00:00+11:00\"},{\"ChallengeArea\":\"outdoors\",\"EventName\":\"Camp: Narabeen\",\"EventDate\":\"2021-03-13T01:00:00+11:00\"},{\"ChallengeArea\":\"community\",\"EventName\":\"District Fun Camp\",\"EventDate\":\"2021-02-13T20:00:00+11:00\"},{\"ChallengeArea\":\"community\",\"EventName\":\"Clean Up Australia Day\",\"EventDate\":\"2021-03-07T19:45:00+11:00\"},{\"ChallengeArea\":\"community\",\"EventName\":\"Langstone Place Site Visit\",\"EventDate\":\"2021-04-01T05:00:00+11:00\"},{\"ChallengeArea\":\"community\",\"EventName\":\"Epping RSL Anzac Day March\",\"EventDate\":\"2021-04-18T23:45:00+10:00\"},{\"ChallengeArea\":\"community\",\"EventName\":\"Bike Ride to the Escarpment Boardwalk\",\"EventDate\":\"2021-04-29T04:30:00+10:00\"},{\"ChallengeArea\":\"community\",\"EventName\":\"Mother's Day Flower sales\",\"EventDate\":\"2021-05-09T17:00:00+10:00\"},{\"ChallengeArea\":\"personal_growth\",\"EventName\":\"Badgework\",\"EventDate\":\"2021-03-11T06:00:00+11:00\"},{\"ChallengeArea\":\"personal_growth\",\"EventName\":\"Stilt Soccer\",\"EventDate\":\"2021-03-18T06:00:00+11:00\"},{\"ChallengeArea\":\"personal_growth\",\"EventName\":\"Crate Stacking\",\"EventDate\":\"2021-05-06T05:00:00+10:00\"},{\"ChallengeArea\":\"personal_growth\",\"EventName\":\"Frisbee Night\",\"EventDate\":\"2021-05-20T05:00:00+10:00\"},{\"ChallengeArea\":\"personal_growth\",\"EventName\":\"First Aid Talk\",\"EventDate\":\"2021-08-11T19:00:00+10:00\"},{\"ChallengeArea\":\"personal_growth\",\"EventName\":\"Water Safety Night\",\"EventDate\":\"2021-12-01T18:30:00+11:00\"}],\"AssistLogs\":[{\"ChallengeArea\":\"creative\",\"EventName\":\"Science Night\",\"EventDate\":\"2022-03-09T19:00:00+11:00\"},{\"ChallengeArea\":\"outdoors\",\"EventName\":\"District Camp \",\"EventDate\":\"2022-06-10T17:00:00+10:00\"}],\"LeadLogs\":[{\"ChallengeArea\":\"outdoors\",\"EventName\":\"Frisbee Footbal\",\"EventDate\":\"2022-02-23T19:00:00+11:00\"}]},{\"Milestone\":2,\"Status\":\"Awarded\",\"Awarded\":\"2023-05-21T19:16:38.586556+10:00\",\"ParticipateLogs\":[{\"ChallengeArea\":\"community\",\"EventName\":\"Bouldering\",\"EventDate\":\"2021-05-12T04:30:00+10:00\"},{\"ChallengeArea\":\"community\",\"EventName\":\"Alphabet Scavenger Night\",\"EventDate\":\"2021-11-03T19:00:00+11:00\"},{\"ChallengeArea\":\"community\",\"EventName\":\"Chalk Chase\",\"EventDate\":\"2021-11-24T19:00:00+11:00\"},{\"ChallengeArea\":\"community\",\"EventName\":\"Ice Blocking Night\",\"EventDate\":\"2021-12-15T19:00:00+11:00\"},{\"ChallengeArea\":\"community\",\"EventName\":\"Channel 10 Morning Show\",\"EventDate\":\"2022-04-27T08:30:00+10:00\"},{\"ChallengeArea\":\"outdoors\",\"EventName\":\"Moocooboolah District Hike\",\"EventDate\":\"2021-04-17T09:00:00+10:00\"},{\"ChallengeArea\":\"outdoors\",\"EventName\":\"Fire in the hole\",\"EventDate\":\"2021-06-02T19:00:00+10:00\"},{\"ChallengeArea\":\"outdoors\",\"EventName\":\"District Camp Prep\",\"EventDate\":\"2021-06-09T19:00:00+10:00\"},{\"ChallengeArea\":\"outdoors\",\"EventName\":\"@Home Backyard Camp\",\"EventDate\":\"2021-09-25T18:00:00+10:00\"},{\"ChallengeArea\":\"outdoors\",\"EventName\":\"Night Hike\",\"EventDate\":\"2021-10-20T19:00:00+11:00\"},{\"ChallengeArea\":\"creative\",\"EventName\":\"Fire Cooking\",\"EventDate\":\"2022-05-18T19:00:00+10:00\"},{\"ChallengeArea\":\"creative\",\"EventName\":\"District Camp Construction\",\"EventDate\":\"2022-06-01T19:00:00+10:00\"},{\"ChallengeArea\":\"creative\",\"EventName\":\"Campfire Skit Night\",\"EventDate\":\"2022-06-29T19:00:00+10:00\"},{\"ChallengeArea\":\"creative\",\"EventName\":\"Knot Games\",\"EventDate\":\"2022-07-27T19:00:00+10:00\"},{\"ChallengeArea\":\"creative\",\"EventName\":\"Fire in the hole!\",\"EventDate\":\"2023-04-26T19:00:00+10:00\"},{\"ChallengeArea\":\"personal_growth\",\"EventName\":\"Canoe Night\",\"EventDate\":\"2021-12-08T18:30:00+11:00\"},{\"ChallengeArea\":\"personal_growth\",\"EventName\":\"Aquatics OAS Badgework\",\"EventDate\":\"2022-02-02T19:00:00+11:00\"},{\"ChallengeArea\":\"personal_growth\",\"EventName\":\"Scouthike Prep\",\"EventDate\":\"2022-04-27T19:00:00+10:00\"},{\"ChallengeArea\":\"personal_growth\",\"EventName\":\"Scouthike\",\"EventDate\":\"2022-04-29T19:00:00+10:00\"},{\"ChallengeArea\":\"personal_growth\",\"EventName\":\"Rope Night\",\"EventDate\":\"2022-05-04T19:00:00+10:00\"}],\"AssistLogs\":[{\"ChallengeArea\":\"community\",\"EventName\":\"Chip Chase\",\"EventDate\":\"2022-07-20T19:00:00+10:00\"},{\"ChallengeArea\":\"creative\",\"EventName\":\"Campfire Skit Night\",\"EventDate\":\"2022-09-21T19:00:00+10:00\"},{\"ChallengeArea\":\"community\",\"EventName\":\"Bunnings Sausage Sizzle\",\"EventDate\":\"2022-12-17T07:00:00+11:00\"}],\"LeadLogs\":[{\"ChallengeArea\":\"community\",\"EventName\":\"Stick Map Planning\",\"EventDate\":\"2022-08-17T19:00:00+10:00\"},{\"ChallengeArea\":\"creative\",\"EventName\":\"New Games Night\",\"EventDate\":\"2022-08-31T19:00:00+10:00\"}]},{\"Milestone\":3,\"Status\":\"In Progress\",\"Awarded\":\"0001-01-01T00:00:00\",\"ParticipateLogs\":[{\"ChallengeArea\":\"community\",\"EventName\":\"Badminton\",\"EventDate\":\"2022-06-22T18:30:00+10:00\"},{\"ChallengeArea\":\"community\",\"EventName\":\"Unit Council\",\"EventDate\":\"2022-08-23T19:30:00+10:00\"},{\"ChallengeArea\":\"community\",\"EventName\":\"Granny Smith Festival\",\"EventDate\":\"2022-10-15T08:00:00+11:00\"},{\"ChallengeArea\":\"community\",\"EventName\":\"Davidson RFS Visit\",\"EventDate\":\"2022-11-09T18:30:00+11:00\"},{\"ChallengeArea\":\"outdoors\",\"EventName\":\"Bike Night\",\"EventDate\":\"2021-10-27T18:30:00+11:00\"},{\"ChallengeArea\":\"outdoors\",\"EventName\":\"Freedom Hike\",\"EventDate\":\"2021-11-13T10:00:00+11:00\"},{\"ChallengeArea\":\"outdoors\",\"EventName\":\"Canoe Night\",\"EventDate\":\"2021-11-17T18:30:00+11:00\"},{\"ChallengeArea\":\"outdoors\",\"EventName\":\"Canoe Camp\",\"EventDate\":\"2021-12-11T09:00:00+11:00\"},{\"ChallengeArea\":\"personal_growth\",\"EventName\":\"Bushwalking OAS Badgework\",\"EventDate\":\"2022-05-11T19:00:00+10:00\"},{\"ChallengeArea\":\"personal_growth\",\"EventName\":\"Air Soccer\",\"EventDate\":\"2022-05-25T19:00:00+10:00\"},{\"ChallengeArea\":\"personal_growth\",\"EventName\":\"Unit Council\",\"EventDate\":\"2022-06-28T19:30:00+10:00\"},{\"ChallengeArea\":\"personal_growth\",\"EventName\":\"Unit Council\",\"EventDate\":\"2022-07-26T19:30:00+10:00\"},{\"ChallengeArea\":\"creative\",\"EventName\":\"Sports Night\",\"EventDate\":\"2023-05-24T19:00:00+10:00\"},{\"ChallengeArea\":\"creative\",\"EventName\":\"Campfire Night\",\"EventDate\":\"2023-06-28T19:00:00+10:00\"}],\"AssistLogs\":[{\"ChallengeArea\":\"outdoors\",\"EventName\":\"Scouthike\",\"EventDate\":\"2023-05-05T18:00:00+10:00\"},{\"ChallengeArea\":\"creative\",\"EventName\":\"Knot Night\",\"EventDate\":\"2023-05-17T19:00:00+10:00\"},{\"ChallengeArea\":\"community\",\"EventName\":\"VIVID\",\"EventDate\":\"2023-05-31T18:30:00+10:00\"},{\"ChallengeArea\":\"personal_growth\",\"EventName\":\"Badgework\",\"EventDate\":\"2023-06-21T19:00:00+10:00\"}],\"LeadLogs\":[{\"ChallengeArea\":\"creative\",\"EventName\":\"Mini ScoutHike\",\"EventDate\":\"2023-03-22T19:00:00+11:00\"},{\"ChallengeArea\":\"personal_growth\",\"EventName\":\"Ceremony Night\",\"EventDate\":\"2023-05-10T19:00:00+10:00\"}]}],\"OASSummaries\":[{\"Stream\":\"aquatics\",\"Stage\":1,\"Awarded\":\"2021-12-03T09:32:51.265662+11:00\",\"Section\":\"s\"},{\"Stream\":\"aquatics\",\"Stage\":2,\"Awarded\":\"2021-12-03T09:33:01.264974+11:00\",\"Section\":\"s\"},{\"Stream\":\"aquatics\",\"Stage\":3,\"Awarded\":\"2022-02-03T23:15:40.228673+11:00\",\"Section\":\"s\"},{\"Stream\":\"aquatics\",\"Stage\":4,\"Awarded\":\"2022-11-06T18:45:53.369339+11:00\",\"Section\":\"s\"},{\"Stream\":\"aquatics\",\"Stage\":5,\"Awarded\":\"0001-01-01T00:00:00\",\"Section\":\"s\"},{\"Stream\":\"boating\",\"Stage\":1,\"Awarded\":\"0001-01-01T00:00:00\",\"Section\":\"s\"},{\"Stream\":\"boating\",\"Stage\":2,\"Awarded\":\"0001-01-01T00:00:00\",\"Section\":\"s\"},{\"Stream\":\"boating\",\"Stage\":4,\"Awarded\":\"2023-02-14T21:49:58.150034+11:00\",\"Section\":\"s\"},{\"Stream\":\"bushcraft\",\"Stage\":1,\"Awarded\":\"2020-09-13T00:00:00\",\"Section\":\"c\"},{\"Stream\":\"bushcraft\",\"Stage\":2,\"Awarded\":\"2022-11-23T07:06:58.914731+11:00\",\"Section\":\"s\"},{\"Stream\":\"bushcraft\",\"Stage\":3,\"Awarded\":\"2022-11-25T13:46:27.029859+11:00\",\"Section\":\"s\"},{\"Stream\":\"bushcraft\",\"Stage\":4,\"Awarded\":\"0001-01-01T00:00:00\",\"Section\":\"s\"},{\"Stream\":\"bushcraft\",\"Stage\":4,\"Awarded\":\"0001-01-01T00:00:00\",\"Section\":\"s\"},{\"Stream\":\"bushwalking\",\"Stage\":1,\"Awarded\":\"2019-12-18T00:00:00\",\"Section\":\"c\"},{\"Stream\":\"bushwalking\",\"Stage\":2,\"Awarded\":\"2021-03-17T22:44:56.711351+11:00\",\"Section\":\"s\"},{\"Stream\":\"bushwalking\",\"Stage\":3,\"Awarded\":\"0001-01-01T00:00:00\",\"Section\":\"s\"},{\"Stream\":\"camping\",\"Stage\":1,\"Awarded\":\"2022-02-15T18:20:16.142016+11:00\",\"Section\":\"s\"},{\"Stream\":\"camping\",\"Stage\":2,\"Awarded\":\"2022-02-15T18:20:08.490231+11:00\",\"Section\":\"s\"},{\"Stream\":\"camping\",\"Stage\":3,\"Awarded\":\"0001-01-01T00:00:00\",\"Section\":\"s\"},{\"Stream\":\"camping\",\"Stage\":4,\"Awarded\":\"0001-01-01T00:00:00\",\"Section\":\"s\"},{\"Stream\":\"camping\",\"Stage\":5,\"Awarded\":\"0001-01-01T00:00:00\",\"Section\":\"s\"},{\"Stream\":\"cycling\",\"Stage\":1,\"Awarded\":\"0001-01-01T00:00:00\",\"Section\":\"s\"},{\"Stream\":\"cycling\",\"Stage\":2,\"Awarded\":\"0001-01-01T00:00:00\",\"Section\":\"s\"},{\"Stream\":\"cycling\",\"Stage\":3,\"Awarded\":\"0001-01-01T00:00:00\",\"Section\":\"s\"},{\"Stream\":\"paddling\",\"Stage\":1,\"Awarded\":\"2022-02-15T18:18:53.885129+11:00\",\"Section\":\"s\"},{\"Stream\":\"paddling\",\"Stage\":2,\"Awarded\":\"0001-01-01T00:00:00\",\"Section\":\"s\"},{\"Stream\":\"paddling\",\"Stage\":3,\"Awarded\":\"0001-01-01T00:00:00\",\"Section\":\"s\"},{\"Stream\":\"vertical\",\"Stage\":1,\"Awarded\":\"2019-09-09T00:00:00\",\"Section\":\"c\"},{\"Stream\":\"vertical\",\"Stage\":2,\"Awarded\":\"2022-11-23T07:07:43.203689+11:00\",\"Section\":\"s\"},{\"Stream\":\"alpine\",\"Stage\":1,\"Awarded\":\"2022-11-23T07:07:43.203689+11:00\",\"Section\":\"s\"}],\"Stats\":{\"OasProgressions\":12,\"KmsHiked\":63,\"NightsCamped\":16,\"NightsCampedInSection\":16},\"SIASummaries\":[],\"PeakAward\":{\"PersonalDevelopmentCourse\":\"15/02/23\",\"AdventurousJourney\":\"\",\"PersonalReflection\":\"\",\"Awarded\":\"\"}}"
            };
            if (!Directory.Exists("TestResults"))
                Directory.CreateDirectory("TestResults");
        }

        [TestMethod]
        public void Progress_ToPDF()
        {
            var proxyRequest = new Amazon.Lambda.APIGatewayEvents.APIGatewayProxyRequest();
            proxyRequest.Body = JsonConvert.SerializeObject(_reportGenerationRequest);
            var functionResult = _function.FunctionHandler(proxyRequest, null);
            //Convert Base64String into PDF document
            byte[] bytes = Convert.FromBase64String(functionResult);
            FileStream fileStream = new FileStream(@"TestResults\Progress_ToPDF.pdf", FileMode.Create);
            BinaryWriter writer = new BinaryWriter(fileStream);
            writer.Write(bytes, 0, bytes.Length);
            writer.Close();
        }

    }
}
